## Splat-TT-Auto
An adaptation of [Switch-Fightstick](https://github.com/progmem/Switch-Fightstick), a project enabling programming of Switch controllers, that implements a simple macro to automate experience grinding in Splatoon 3's Tableturf Battle mode

### Description
In order to reach the max level of 50 in Splatoon 3's Tableturf Battle mode, you need to gain a total of 59683 EXP which, with 100 EXP per win and 3 minutes per match, would take just under 30 hours of grinding to reach. I personally do not have enough patience to stare at blue and yellow squares for 30 whole hours (and I have a job), so I wrote this macro to "play" for me. Sure, this program isn't advanced enough to actually win any matches, but since we still get 40 EXP for losing a match, we can just pass every single turn until the match ends, gaining EXP by continually pressing the same set of inputs without thinking. This approach takes an average of 1:58 minutes per match, reaching max rank in under 50 hours (but unlike the manual approach, this can be run passively).

#### How to Use
Go to the Tableturf Battle Dojo, select a rival of your choosing (I recommend the first opponent, Baby Jelly, at Level 1 since they are very unlikely to charge or use specials, which slows down the grinding process), and enter the screen where you select your deck. Disconnect your active controller (by pressing the sync button and once the "Connect controller" screen appears, plug in the Arduino, which should start sending inputs to the console. Feel free to leave running as long as you want, and unplug once you reach your desired level (or you just want to use your Switch again). 

This repository has been tested using a Teensy 2.0++, Arduino UNO R3, Arduino Micro, and a Pro Micro.

#### Compiling and Flashing onto the Teensy 2.0++
Go to the Teensy website and download/install the [Teensy Loader application](https://www.pjrc.com/teensy/loader.html). For Linux, follow their instructions for installing the [GCC Compiler and Tools](https://www.pjrc.com/teensy/gcc.html). For Windows, you will need the [latest AVR toolchain](https://www.microchip.com/en-us/tools-resources/develop/microchip-studio/gcc-compilers/) from the Atmel site. See [this issue](https://github.com/LightningStalker/Splatmeme-Printer/issues/10) and [this thread](http://gbatemp.net/threads/how-to-use-shinyquagsires-splatoon-2-post-printer.479497/) on GBAtemp for more information. (Note for Mac users - the AVR MacPack is now called AVR CrossPack. If that does not work, you can try installing `avr-gcc` with `brew`.)

Next, you need to grab the LUFA library. You can download it in a zipped folder at the bottom of [this page](http://www.fourwalledcubicle.com/LUFA.php). Unzip the folder, rename it `LUFA`, and place it where you like. Then, download or clone the contents of this repository onto your computer. Next, you'll need to make sure the `LUFA_PATH` inside of the `makefile` points to the `LUFA` subdirectory inside your `LUFA` directory. My `Splat-TT-Auto` directory is in the same directory as my `LUFA` directory, so I set `LUFA_PATH = ../LUFA/LUFA`.

Now you should be ready to rock. Open a terminal window in the `Splat-TT-Auto` directory, type `make`, and hit enter to compile. If all goes well, the printout in the terminal will let you know it finished the build! Follow the directions on flashing `Joystick.hex` onto your Teensy, which can be found page where you downloaded the Teensy Loader application.

#### Compiling and Flashing onto the Arduino UNO R3
You will need to set your [Arduino in DFU mode](https://www.arduino.cc/en/Hacking/DFUProgramming8U2), and flash its USB controller. (Note for Mac users - try [brew](https://brew.sh/index_it.html) to install the dfu-programmer with `brew install dfu-programmer`.) Setting an Arduino UNO R3 in DFU mode is quite easy, all you need is a jumper (the boards come with the needed pins in place). Please note that once the board is flashed, you will need to flash it back with the original firmware to make it work again as a standard Arduino. To compile this project you will need the AVR GCC Compiler and Tools, as mentioned above in the instructions for Teensy 2.0++. (Again for Mac users - try brew, adding the [osx-cross/avr](osx-cross/avr) repository, all you need to do is to type `brew tap osx-cross/avr` and `brew install avr-gcc`.) Next, you need to grab the LUFA library: download and install it following the steps described for the Teensy 2.0++.

Finally, open a terminal window in the `Splat-TT-Auto` directory, edit the `makefile` setting `MCU = atmega16u2`, and compile by typing `make`. Follow the [DFU mode directions](https://www.arduino.cc/en/Hacking/DFUProgramming8U2) to flash `Joystick.hex` onto your Arduino UNO R3 and you are done.

#### Compiling and Flashing onto the Arduino Micro
The Arduino Micro is more like the Teensy in that it has a single microcontroller that communicates directly over USB. Most of the steps are the same as those for the Teensy, except do not download Teensy Loader program. You will also need to edit `makefile` before issuing `make`. Change `MCU = at90usb1286` on line 15 to `MCU = atmega32u4`.

Once finished building, start up Arduino IDE. Under `File -> Preferences`, check `Show verbose output during: upload` and pick OK. With the Arduino plugged in and properly selected under `Tools`, upload any sketch. Find the line with `avrdude` and copy the entire `avrdude` command and all options into a terminal, replacing the `.hex` file and path to the location of the `Joystick.hex` created in the previous step. Also make sure the `-P/dev/??` port is the same as what Arduino IDE is currently reporting. Now double tap the reset button on the Arduino and quickly press Enter in the terminal. This may take several tries. You may need to press Enter first and then the reset button or try various timings. Eventually, `avrdude` should report success. Store the `avrdude` command in a text file or somewhere safe since you will need it every time you want to print a new image.

Sometimes, the Arduino will show up under a different port, so you may need to run Arduino IDE again to see the current port of your Micro.

If you ever need to use your Arduino Micro with Arduino IDE again, the process is somewhat similar. Upload your sketch in the usual way and double tap reset button on the Arduino. It may take several tries and various timings, but should eventually be successful.

The Arduino Leonardo is compatible, but has not been tested. It also has the ATmega32u4 and its rough-equivalent board, the Pro Micro, does work.